# 데이터 베이스


## 4.1 데이터 베이스의 기본

### 4.1.1 엔터티

여러개의 속성을 지닌 명사.

- 유무형에 따른 분류

유형 엔티티: 물리적, 안정적(불변), 지속적인 엔티티. ex) 사원, 제품, 교수...

개념 엔티티: 개념적으로 존재, 정보로 구분 ex) 강의, 금융상품, 부서...

사건 엔티티: 비즈니스 프로세스에 따라 발생. 데이터가 많다. ex) 구매, 판매, 영업, 수납...

- 발생 시점에 따른 엔티티 분류

기본 엔티티: 키 엔티티라고 하며, 독립적으로 생성 및 관리. ex) 고객, 부서, 판매 제품...

중심 엔티티: 기본 엔티티로부터 발생, 행위 엔티티를 생성하는 중간 엔티티. ex) 계좌, 주문, 수납 ...

행위 엔티티: 상위에 있는 2개 이상의 엔티티로 부터 발생되는 엔티티. ex) 주문 이력, 접속 이력, 수납 이력...



### 4.1.2 릴레이션

데이터베이스에서 정보를 구분하여 저장하는 기본 단위.
엔티티에 관한 데이터는 데이터베이스에서 릴레이션에 담긴다. 테이블, 컬렉션

### 4.1.3 속성

구체적이며 고유한 이름을 갖는 정보. 

- 더 이상 분리되지 않는 정보. 최소의 데이터 단위.
- 엔티티는 두 개 이상의 인스턴스, 속성을 가진다. 

속성의 특징

- 속성은 업무에서 관리되는 정보
- 속성은 하나의 값만 가진다.
- 주식별자에게 함수적으로 종속된다. 기본키에 따라 속성의 값도 변경 될 수 있다.


특성에 따른 속성의 종류

- 기본 속성: 비즈니스 프로세스에서 도출된 본래의 속성(불변) ex) 이름, id, 전화번호...

- 설계 속성: 데이터 모델링 과정에서 발생되는 속성 ex) 상품코드, 지점코드...

- 파생 속성: 다른 속성에 의해서 만들어지는 속성, 정합성을 위해 적은게 좋다. ex) 합계, 평균...

### 4.1.4 도메인

속성이 가질 수 있는 값의 집합. 남성 -> [남, 여]

### 4.1.5 필드와 레코드 

세로 : 필드
가로 : 레코드

### 4.1.6 관계

1:1, 1:N, N:M 관계

### 4.1.7 키


- 식별자

키의 추상적인 개념 (논리적 데이터 모델링 단계 : 식별자, 물리적 데이터 모델링 단계 : 키)
ERD에선 식별자로 나타난다...

![ㅁ](./src/%EC%88%9C%EB%A1%9D1.png)

후보키 ⊂ (기본키 ∪ 대체키)


- 기본키(Primary Key)
    유일성, 최소성. 


## 4.2 ERD와 정규화 과정

### 4.2.1 ERD의 중요성

암튼 중요함.

### 4.2.2 예제로 배우는 ERD

### 4.2.3 정규화


1NF, 2NF, 3NF

1 정규화 - 중복을 제거

    중복을 제거한다는 말이 함수적 종속을 제거하는 의미로 볼 수 있어 조금 모호하다. 국내에서는 원자성 정도만 지키는 걸로 만족하는 듯....

2 정규화 - 부분 함수적 종속을 제거

    모든 컬럼이 기본키에 종속적으로, 여기서 기본키가 복합키인 경우, 복합키를 구성하는 컬럼에 종속이면 이것도 부분 함수적 종속임. 

    해서 기본키에 대해 완전 함수적 종속을 만족.

3 정규화 - 이행 함수적 종속을 제거 

    일단 모든 컬럼이 기본키에 완전 함수적 종속인데 다른 컬럼에 종속이면 이행 함수적 종속임.


BCNF - 후보키가 아닌 결정자의 함수 종속 제거

    어느 컬럼이 복합키로 구성된 기본키에 종속임. 근데 그놈이 복합키를 구성하는 특정 컬럼을 결정지음(결정자, 종속되어있다). 


![ㅁ](./src/%EC%88%9C%EB%A1%9D3.png)


[정규형 위키](https://ko.wikipedia.org/wiki/%EC%A0%9C1%EC%A0%95%EA%B7%9C%ED%98%95
)




## 4.3 트랜잭션과 무결성

### 4.3.1 트랜잭션

DB에서 하나의 논리적 기능을 수행하기 위한 작업의 단위. 

여러 쿼리를 하나로 묶는 단위. Atomicity, Consistency, Isolation, Duurability 가 있다.

- 원자성

트랜잭션내 쿼리가 모두 수행되었거나 되지 않았거나를 보장함.

all or nothing, 커밋 되거나 롤백되거나. (데이터 무결성)

특정 쿼리가 실패하면 전부 실패하도록 구현되어있고, 때때로 충돌 요인에 대해 선택지를 제공할 수도있다.


- 일관성

트랜잭션 이후에 데이터베이스는 데이터베이스의 제약이나 규칙을 만족해야한다.

데이터베이스의 Constraint가 바뀌지 않음. not null 같은...


- 격리성

모든 트랜잭션은 독립적이다.

팬텀 리드 : 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 해당 조회 결과가 다른 경우.

반복 가능하지 않은 조회 : 한 트랜잭션 내에서 같은 행에 두 번 이상의 조회가 발생했는데, 값이 다른 경우.

더티 리드 : 다른 트랜잭션에 의해 수정되었지만 아직 '커밋되지 않은' 행의 데이터를 읽을 수 있을 때


++ 격리 수준

SERIALIZABLE - 트랜 잭션을 순차적으로 진행시키는 것. 동시에 같은 행에 접근할 수 없다. 기다리기 때문에 교착 상태가 일어날 확률이 높고, 오래걸림.

REPEATABLE_READ - 수정한 행을 수정할 수 없지만, 새로운 행을 추가하는 것이 가능.

READ_COMMITTED - 다른 트랜잭션이 커밋하지 않은 정보는 읽을 수 없다. 

READ_UNCOMMITTED - 하나의 트랜잭션이 커밋되기 이전에 다른 트랜잭션에 노출되는 문제가 있지만 가장 빠름. 

무결성이 중요하지않고 대용량 처리시 어림잡을 때 용이.


- 지속성

수행된 트랜잭션은 영원히 반영되어야하는 것. 시스템 장애가 발생해도 원래 상태로 복구가능.


### 4.3.2 무결성

데이터의 정확성과 일관성을 유지하고 보증하는 것을 가리킴. 

일반적으로 일련의 무결성 제한이나 규칙에 의해 데이터베이스 시스템이 강제한다. 무결성 제한들은 관계형 데이터 모델의 기본 기능의 일부로 볼 수 있다.

데이터 베이스에 저장된 값과 현실 세계의 실제 값이 일치하는지..

개체 무결성, 참조 무결성, 고유 무결성, NULL 무결성


## 4.4 데이터베이스의 종류

### 4.4.1 관계형 데이터베이스

행과 열을 가지는 표 형식 데이터 베이스. SQL 언어로 조작한다.

- MySQL

c, c++로 만들어졌다. B-트리 기반 인덱스, 스레드 기반의 메모리 할당 시스템, 매우 빠른 조인 등이 특징.


- PostgreSQL

### 4.4.2 NoSQL 데이터베이스

- MongoDB

jSON을 통해 데이터에 접근할 수 있다. key-value 데이터 모델에서 확장된 도큐먼트 기반의 데이터베이스.

스키마를 저장할 필요가 없다.. 

빅데이터 저장시 성능이 좋고, 고가용성과 샤딩, 레플리카셋을 지원함. 

![ㅁ](./src/%EC%88%9C%EB%A1%9D5.png)


## 4.5 인덱스

### 4.5.1 인덱스의 필요성

빠르게 데이터를 찾을 수 있는 하나의 장치



### 4.5.2 B-트리

![ㅁ](./src/%EC%88%9C%EB%A1%9D6.png)



### 4.5.3 인덱스를 만드는 방법

클러스터 인덱스 : 데이터를 가리키는 포인터가 아닌 데이터를 저장한 블록의 포인터를 저장함.

![ㅁ](./src/%EC%88%9C%EB%A1%9D7.png)


![ㅁ](./src/%EC%88%9C%EB%A1%9D8.png)

https://hudi.blog/db-clustered-and-non-clustered-index/


- MySQL

- MongoDB

### 4.5.4 인덱스 최적화 기법

## 4.6 조인의 종류

![ㅁ](./src/%EC%88%9C%EB%A1%9D9.png)

### 4.6.1 내부 조인

### 4.6.2 왼쪽 조인

### 4.6.3 오른쪽 조인

### 4.6.4 합집합 조인

## 4.7 조인의 원리

### 4.7.1 중첩 루프 조인

Nested Loop Join

for 문을 두 번 도는 것과 같다. 랜덤 엑세스..

![ㅁ](./src/%EC%88%9C%EB%A1%9D10.png)



### 4.7.2 정렬 병합 조인

테이블을 정렬하고 나서 조인을 하는 것.

for문은 한 번만 돌아도 되긴하나 정렬이 되어있어야한다.

![ㅁ](./src/%EC%88%9C%EB%A1%9D11.png)


### 4.7.3 해시 조인

하나의 테이블을 미리 해시해두어서 찾는 것.

한번만 for문을 돌면 된다.

![ㅁ](./src/%EC%88%9C%EB%A1%9D12.png)


https://etutorials.org/Misc/advanced+dba+certification+guide+and+reference/Chapter+6.+The+DB2+Optimizer/Joining+in+DB2+UDB/


https://itpfdoc.hitachi.co.jp/manuals/3000/30006502H0e/HAPG0085.HTM
